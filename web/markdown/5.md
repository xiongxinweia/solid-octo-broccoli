+ [author](https://github.com/3293172751)

# 第5节 FTP协议

+ [回到目录](../README.md)
+ [回到项目首页](../../README.md)
+ [上一节](4.md)
> ❤️💕💕计算机网络--TCP/IP 学习。Myblog:[http://nsddd.top](http://nsddd.top/)
---
[TOC]



## FTP协议

> 这本书省略了FTP

### 一些术语和基本概念、约定

+ **文件传输协议（缩写：FTP）**是用于在网络上进行文件传输的一套标准协议。它属于网络传输协议的应用层。

### FTP概况

+ FTP是一个8位的客户端-服务器协议，能操作任何类型的文件而不需要进一步处理，就像MIME或Unicode一样。
+ FTP有着极高的延时，这意味着，从开始请求到第一次接收需求数据之间的时间，会非常长；并且不时的必须执行一些冗长的登陆进程。
+ FTP服务一般运行在20和21两个端口。端口20用于在客户端和服务器之间传输数据流，而端口21用于传输控制流，并且是命令通向ftp服务器的进口。
+ 当数据通过数据流传输时，控制流处于空闲状态。而当控制流空闲很长时间后，客户端的防火墙会将其会话置为超时，这样当大量数据通过防火墙时，会产生一些问题。此虽然文件可以成功的传输，但因为控制会话会被防火墙断开；传输会产生一些错误。
+ 运行FTP服务的许多站点都开放匿名服务，匿名用户的用户名是：“anonymous”。这个帐号不需要密码。
+ FTP是个有状态连接 必须追踪用户所在的文件树

### FTP缺点

+ 密码和文件内容都使用明文传输，可能发生窃听。
+ 因为必须开放一个随机的端口以创建连接，当防火墙存在时，客户端很难过滤处于主动模式下的FTP流量。这个问题，通过使用被动模式的FTP，得到了很大解决。
+ 服务器可能会被告知连接一个第三方计算机的保留端口。
+ 此方式在需要传输文件数量很多的小文件时，性能不好。

### 主动和被动模式

FTP有两种使用模式：主动和被动。主动模式要求客户端和服务器端同时打开并且监听一个端口以创建连接。在这种情况下，客户端由于安装了防火墙会产生一些问题。所以，创立了被动模式。被动模式只要求服务器端产生一个监听相应端口的进程，这样就可以绕过客户端安装了防火墙的问题。  

一个主动模式的FTP连接创建要遵循以下步骤：

1. 客户端打开一个随机的端口（端口号大于1024，在这里，我们称它为x），同时一个FTP进程连接至服务器的21号命令端口。此时，该tcp连接的来源地端口为客户端指定的随机端口x，目的地端口（远程端口）为服务器上的21号端口。
2. 客户端开始监听端口（x+1），同时向服务器发送一个端口命令（通过服务器的21号命令端口），此命令告诉服务器客户端正在监听的端口号并且已准备好从此端口接收数据。这个端口就是我们所知的数据端口。
3. 服务器打开20号源端口并且创建和客户端数据端口的连接。此时，来源地的端口为20，远程数据(目的地)端口为（x+1）。
4. 客户端通过本地的数据端口创建一个和服务器20号端口的连接，然后向服务器发送一个应答，告诉服务器它已经创建好了一个连接。



## 补充—搭建ftp

安装vsftpd

服务器centos: 

```
yum install -y vsftpd
```

 

添加用户

```
useradd ftpuser
```

 

给用户名设置密码

```
pass ftpuser
```

 

备注：在ftp配置文件（etc/vsftpd/.conifg ）

设置用户匿名访问

 

2、启动服务

使用vsftpd软件，主要包括如下几个命令：

启动ftp命令

```
\#service vsftpd start
```

停止ftp命令

```
\#service vsftpd stop
```

重启ftp命

```
\#service vsftpd restart
```

 

3、vsftpd的配置

ftp的配置文件主要有三个，位于/etc/vsftpd/目录下，分别是：

ftpusers 该文件用来指定那些用户不能访问ftp服务器。

user_list 该文件用来指示的默认账户在默认情况下也不能访问ftp

vsftpd.conf vsftpd的主配置文件

 

4、以匿名用户登录

我们去掉配置文件vsftpd.conf 里面以下

```
anon_upload_enable=YES
anon_mkdir_write_enable=YES
```

两项前面的#号，就可以完成匿名用户的配置，此时匿名用户既可以登录上传、下载文件。记得修改配置文件后需要重启服务。

 

5、非匿名账户的创建与使用

vsftpd服务与系统用户是相互关联的，例如我们创建一个名为testwww

```
#useradd testwww
#passwd testwww
```

6、登录方式

浏览器上输入

[ftp://vsftp所在机器ip/](ftp://vsftp所在机器ip/)



文件打开 ：

文件夹输入

[ftp://vsftp所在机器ip/](ftp://vsftp所在机器ip/) ；

 右键可以选择登录

 



## END 链接
+ [回到目录](../README.md)
+ [上一节](4.md)
+ [下一节](6.md)
---
+ [参与贡献❤️💕💕](https://github.com/3293172751/CS_COURSE/blob/master/Git/git-contributor.md)
